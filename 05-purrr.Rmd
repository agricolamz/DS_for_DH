---
output: html_document
editor_options: 
  chunk_output_type: console
---
# Работа со списками {#lists}

## Что такое списки?
Мы обсуждали в разделе \@ref{list} тип данных *список*, и все особенности их синтаксиса:

```{r}
x <- list(l = "a", m = c(2, 4), n = c("blue", "green", "red"))
x
x$l
x[1]
x[[2]]
x[[2]][2]
```

![](images/lists.png)

Списки вне R обычно хранят в файлах типа `.json` (по-английски говорят с ударением на первый слог, а вот по-русски прижился вариант с ударением на второй слог: джейсо́н). Самое важное, что нужно знать, про .json, это то, что там могут хранится:

* пары ключ и значение, заключенные в фигурные скобки `{"ключ":"значение"}`
* упорядочные множества значений, заключенные в квадратные скобки `["значение_1","значение_2",...]`
* некоторые другие типы данных

Чтение и запись `.json` файлов осуществляется при помощи пакета `jsonlite` (не входит в `tidyverse`). Для примера скачаем датасет 30 героев Игры престолов, который  Дж. Р. Р. Мартин достал с ресурса [An API of Ice And Fire](https://anapioficeandfire.com/).

```{r}
library(jsonlite)
got_chars <- read_json("https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/got_chars.json")
library("rjson")
got_chars <- repurrrsive::got_chars


rjson::toJSON(got_chars)
write_json(got_chars, "data/got_chars.json", auto_unbox=TRUE)
got_chars2 <- fromJSON("data/got_chars.json", simplifyVector = FALSE)
```

По аналогии с другими функциями в R, пакет `jsonlite` позволяет записывать `.json` файлы:
```{r, eval=FALSE}
write_json(got_chars, "got_chars.json")
```

Просмоторщик списков встроен в RStudio. Его можно увидеть, если ткнуть в объект в R или написать команду `View(got_chars)`. Альтернативой может стать функция `jsonedit()` из пакета `listviewer`. Кроме того, что-то можно попробовать выяснить, используя функцию `str()`.

```{r}
str(got_chars[1])
```

## Пакет `purrr`

В `tidyverse` встроен пакет `purrr`, который среди прочего позволяет работать со списками.

```{r, message=FALSE}
library("tidyverse")
```

Можно выводить значения в списке на основе имени:

```{r}
got_chars[1:4] %>% 
  map("name")
```

Можно выводить значения в списке на основе индекса:

```{r}
got_chars[1:3] %>% 
  map(1)
```

Достаточно полезно знать о функции `unlist()`, которая "убивает" все сложную структуру:

```{r}
got_chars2 %>% 
  map("name")
```

