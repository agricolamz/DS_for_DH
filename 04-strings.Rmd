---
output: html_document
editor_options: 
  chunk_output_type: console
---
# –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ {#strings}

## –†–∞–±–æ—Ç–∞ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ –≤ R

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

* –±–∞–∑–æ–≤—ã–π R
* –ø–∞–∫–µ—Ç `stringr` (—á–∞—Å—Ç—å `tidyverse`)
* –ø–∞–∫–µ—Ç `stringi` -- –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç, —Ç–∞–∫ —á—Ç–æ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```{r, eval=FALSE}
install.packages("stringi")
library(tidyverse)
library(stringi)
```

```{r, include=FALSE}
library(tidyverse)
library(stringi)
```

–ú—ã –±—É–¥–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–∞–∫–µ—Ç–∞–º–∏ `stingr` –∏ `stringi`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞—è—Ö —É–¥–æ–±–Ω–µ–µ. –ö —Å—á–∞—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–∏ —ç—Ç–∏—Ö –ø–∞–∫–µ—Ç–æ–≤ –ª–µ–≥–∫–æ –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö: —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞–∫–µ—Ç `stringr` –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `str_`, –∞ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞–∫–µ—Ç–∞ `stringi` --- c `stri_`.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç [cheat sheet –ø–æ `stringr`](https://github.com/rstudio/cheatsheets/raw/master/strings.pdf).

## –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫—É?

* —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∫–∞–≤—ã—á–∫–∞–º–∏
```{r}
"the quick brown fox jumps over the lazy dog"
'the quick brown fox jumps over the lazy dog'
"the quick 'brown' fox jumps over the lazy dog"
'the quick "brown" fox jumps over the lazy dog'
```

* –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
```{r}
""
''
character(3)
```

* –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
```{r}
typeof(4:7)
as.character(4:7)
```

* –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã
```{r}
letters
LETTERS
month.name
```

* –ø–æ–º–Ω–∏—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ `data.frame()`, `read.csv()`,  `read.csv2()`, `read.table()` –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ R –≤—Å–µ–≥–¥–∞ –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç —Å—Ç—Ä–æ–∫–∏ –≤ —Ñ–∞–∫—Ç–æ—Ä—ã, –∏ —á—Ç–æ–±—ã —ç—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç `stringsAsFactors`. –≠—Ç–æ –º–Ω–æ–≥–æ –æ–±—Å—É–∂–¥–∞–ª–æ—Å—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ R, –º–æ–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—á–∏—Ç–∞—Ç—å –ø—Ä–æ —ç—Ç–æ [–≤–æ—Ç —ç—Ç–æ—Ç –±–ª–æ–≥ –ø–æ—Å—Ç –†–æ–¥–∂–µ—Ä–∞ –ü–µ–Ω–≥–∞](https://simplystatistics.org/2015/07/24/stringsasfactors-an-unauthorized-biography/).
```{r}
str(data.frame(letters[6:10], LETTERS[4:8]))
str(data.frame(letters[6:10], LETTERS[4:8], stringsAsFactors = FALSE))
```

–ù–æ —ç—Ç–æ–º –∫—É—Ä—Å–µ –º—ã —É—á–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É `tibble()`, `read_csv()`, `read_csv2()`, `read_tsv()`, `read_delim()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `readr` (–≤—Ö–æ–¥–∏—Ç –≤ `tidyverse`).

* –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö —Å—Ç—Ä–æ–∫
```{r}
set.seed(42)
stri_rand_strings(n = 10, length = 5:14)
```

* –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç —Å–∏–º–≤–æ–ª—ã –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏
```{r}
stri_rand_shuffle("–ª—é–±—è, —Å—ä–µ—à—å —â–∏–ø—Ü—ã, ‚Äî –≤–∑–¥–æ—Ö–Ω—ë—Ç –º—ç—Ä, ‚Äî –∫–∞–π—Ñ –∂–≥—É—á")
stri_rand_shuffle(month.name)
```

* –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Å–µ–≤–¥–æ—Ä–∞–Ω–¥–æ–º–Ω—ã–π —Ç–µ–∫—Å—Ç ^[Lorem ipsum --- –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–∫—Ç–∞—Ç–∞ –ú–∞—Ä–∫–∞ –¢—É–ª–ª–∏—è –¶–∏—Ü–µ—Ä–æ–Ω–∞ "–û –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ–±—Ä–∞ –∏ –∑–ª–∞". –ï–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–º–æ—Ç—Ä–∏—Ç—å—Å—è, –∫–æ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ç–µ–∫—Å—Ç–æ–º]
```{r}
stri_rand_lipsum(nparagraphs = 2)
```

## –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫

–°–æ–µ–¥–∏–Ω–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é `str_c()`, –≤ –∫–æ—Ç–æ—Ä—É—é, –∫–∞–∫ –∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `—Å()`, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:
```{r}
tibble(upper = rev(LETTERS), smaller = letters) %>% 
  mutate(merge = str_c(upper, smaller))
```

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –µ—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–æ–±–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, —É–∫–∞–∑–∞–≤ –µ–≥–æ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ `sep`:

```{r}
tibble(upper = rev(LETTERS), smaller = letters) %>% 
  mutate(merge = str_c(upper, smaller, sep = "_"))
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –æ–±—Ä–∞–∑–æ–º, –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `separate()`. –≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–∑–Ω–æ—Å–∏—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–æ–∫–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–æ–ª–±—Ü—ã. –£ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–∞: `col` --- –∫–æ–ª–æ–Ω–∫–∞, –∫–æ—Ç–æ—Ä—É—é —Å–ª–µ–¥—É–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å, `into` --- –≤–µ–∫—Ç–æ—Ä –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–æ–≤—ã—Ö —Å—Ç–æ–ª–±–µ—Ü, `sep` --- —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å.

```{r}
tibble(upper = rev(LETTERS), smaller = letters) %>% 
  mutate(merge = str_c(upper, smaller, sep = "_")) %>% 
  separate(col = merge, into = c("column_1", "column_2"), sep = "_")
```

## –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤

### –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–º–≤–æ–ª–æ–≤

![](images/5.01_str_length.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(n_charactars = str_count(mn))
```

### –ü–æ–¥–≥–æ–Ω–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–º–≤–æ–ª–æ–≤

–ú–æ–∂–Ω–æ –æ–±—Ä–µ–∑–∞—Ç—å —Å—Ç—Ä–æ–∫–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é `str_trunc()`:

![](images/5.02_str_trunc.png)
```{r}
tibble(mn = month.name) %>% 
  mutate(mn_new = str_trunc(month.name, 6))
```

–ú–æ–∂–Ω–æ —Ä–µ—à–∏—Ç—å —Å –∫–∞–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –æ–±—Ä–µ–∑–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è –∞—Ä–≥—É–º–µ–Ω—Ç `side`:
```{r}
tibble(mn = month.name) %>% 
  mutate(mn_new = str_trunc(month.name, 6, side = "left"))
tibble(mn = month.name) %>% 
  mutate(mn_new = str_trunc(month.name, 6, side = "center"))
```

–ú–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –∞—Ä–≥—É–º–µ–Ω—Ç `ellipsis`:
```{r}
tibble(mn = month.name) %>% 
  mutate(mn_new = str_trunc(month.name, 3, ellipsis = ""))
```

–ú–æ–∂–Ω–æ –Ω–∞–æ–±–æ—Ä–æ—Ç "—Ä–∞–∑–¥—É—Ç—å" —Å—Ç—Ä–æ–∫—É:

![](images/5.03_str_pad.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(mn_new = str_pad(month.name, 10))
```

–û–ø—è—Ç—å –∂–µ –µ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç `side`:
```{r}
tibble(mn = month.name) %>% 
  mutate(mn_new = str_pad(month.name, 10,  side = "right"))
```

```{block, type = "rmdtask"}
–ù–∞ Pudding –≤—ã—à–ª–∞ [—Å—Ç–∞—Ç—å—è –ø—Ä–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–∞–±—ã](https://pudding.cool/2019/10/pubs/). [–ó–¥–µ—Å—å](https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/UK_pubs.csv) –ª–µ–∂–∏—Ç –Ω–µ–º–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç, –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏. –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ 50 —Å–∞–º—ã—Ö —á–∞—Å—Ç–æ—Ç–æ–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –ø–∞–±–æ–≤ –≤ –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏–∏, –æ—Ç–ª–æ–∂–∏–≤ –ø–æ –æ—Å–∏ x –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤, –∞ –ø–æ –æ—Å–∏ y -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º.
```

```{r, echo=FALSE, message = FALSE}
read_csv("https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/UK_pubs.csv") %>% 
  count(pub_name, sort = TRUE) %>% 
  mutate(nchar = str_length(pub_name)) %>% 
  filter(n>50) %>% 
  ggplot(aes(nchar, n, label = pub_name))+
  geom_point()+
  ggrepel::geom_text_repel()+
  labs(x = "number of symbols",
       y = "number of bars",
       titles = "50 most popular bar names in UK",
       caption = "data from https://pudding.cool/2019/10/pubs/")
```

<details> <summary> üìã —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ ‚û° </summary> 

<details> <summary> üëÅ –î–∞—Ç–∞—Å–µ—Ç —Å–∫–∞—á–∞–ª—Å—è, —á—Ç–æ –¥–∞–ª—å—à–µ? ‚û° </summary>
–ü–µ—Ä–≤–æ-–Ω–∞–ø–µ—Ä–≤–æ —Å–ª–µ–¥—É–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –≤ –∫–æ—Ç–æ—Ä–æ–π –±—ã —Ö—Ä–∞–Ω–∏–ª–æ—Å—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –±–∞—Ä–æ–≤. <br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ä–æ–≤? ‚û° </summary>
–≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `count()`. <br>
</details>

<details> <summary> üëÅ –ë–∞—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª–∏, —á—Ç–æ –¥–∞–ª—å—à–µ? ‚û° </summary>
–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, –≥–¥–µ –±—ã —Ö—Ä–∞–Ω–∏–ª–∞—Å—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–∏–º–≤–æ–ª–æ–≤. <br>
</details>

<details> <summary> üëÅ –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –µ—Å—Ç—å, —Ç–µ–ø–µ—Ä—å —Ä–∏—Å—É–µ–º? ‚û° </summary>
–ù–µ —Å–æ–≤—Å–µ–º. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Ä–∏—Å–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å 50 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö. <br>
</details>

<details> <summary> üëÅ –¢–∞–∫, –≤—Å–µ –≥–æ—Ç–æ–≤–æ, –∞ –∫–∞–∫–∏–µ `geom_()`? ‚û° </summary>
–ù–∞ –≥—Ä–∞—Ñ–∏–∫–µ `geom_point()` –∏ `geom_text_repel()` –∏–∑ –ø–∞–∫–µ—Ç–∞ `ggrepel`. <br>
</details>

<details> <summary> üëÅ –ê-–∞-–∞-–∞! `could not find function "geom_text_repel"` ‚û° </summary>
–ê –≤—ã –≤–∫–ª—é—á–∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É `ggrepel`? –ï—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–∏–ª–∏, —Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. <br>
</details>

<details> <summary> üëÅ –ê-–∞-–∞-–∞! `geom_text_repel requires the following missing aesthetics: label"` ‚û° </summary>
–í—Å–µ, –∫–∞–∫ –Ω–∞–ø–∏—Å–∞–ª–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞: —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –∫–∞–∫–æ–π-—Ç–æ —Ç–µ–∫—Å—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `aes()` –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç `label = pub_name`. –ò–Ω–∞—á–µ –æ—Ç–∫—É–¥–∞ –æ–Ω —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –µ–º—É –ø–∏—Å–∞—Ç—å? <br>
</details>

<details> <summary> üëÅ –§—É—Ñ! –í—Å–µ –≥–æ—Ç–æ–≤–æ! ‚û° </summary>
–ê –æ—Å–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã? –ê –∑–∞–≥–æ–ª–æ–≤–æ–∫? –ê –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö? <br>
</details>
</details>

## –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
–î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `sort()` –∏ —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ `stringr` `str_sort()`:

```{r}
unsorted_latin <- c("I", "‚ô•", "N", "Y")
sort(unsorted_latin)
str_sort(unsorted_latin)
str_sort(unsorted_latin, locale = "lt")
unsorted_cyrillic <- c("—è", "i", "–∂")
str_sort(unsorted_cyrillic)
str_sort(unsorted_cyrillic, locale = "ru_UA")
```

–°–ø–∏—Å–æ–∫ –ª–æ–∫–∞–ª–µ–π –Ω–∞ –∫–æ–ø–º—å—é—Ç–µ—Ä–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `stringi::stri_locale_list()`. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ª–æ–∫–∞–ª–µ–π –≤–æ–æ–±—â–µ –ø—Ä–∏–≤–µ–¥–µ–Ω [–Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ](https://en.wikipedia.org/wiki/List_of_ISO_639-1_codes). –ï—â–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã: `stringi::stri_locale_info` –∏ `stringi::stri_locale_set`.

–ù–µ —É–≥–ª—É–±–ª—è—è—Å—å –≤ [—Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏](https://www.youtube.com/watch?v=BeoCbJPuvSE), –æ—Ç–º–µ—á—É, —á—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é —Ö—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–æ–ª—å—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```{r, cache= TRUE}
set.seed(42)
huge <- sample(letters, 1e7, replace = TRUE)
head(huge)
system.time(
  sort(huge)
)

system.time(
  sort(huge, method = "radix")
)

system.time(
  str_sort(huge)
)

huge_tbl <- tibble(huge)
system.time(
  huge_tbl %>% 
    arrange(huge)
)
```

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: –¥–ª—è –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö -- `sort(..., method = "radix")`.

## –ü–æ–∏—Å–∫ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `str_detect()`:

![](images/5.04_str_detect.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(has_r = str_detect(mn, "r"))
```

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã, –∞ –Ω–µ –∑–Ω–∞—á–µ–Ω–∏—è `TRUE`/`FALSE`:
![](images/5.05_str_which.png)

```{r}
str_which(month.name, "r")
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–∂–¥–µ–Ω–∏–π –∫–∞–∫–æ–π-—Ç–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏:

![](images/5.06_str_count.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(has_r = str_count(mn, "r"))
```

## –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞
```{r}
latin <- "tHe QuIcK BrOwN fOx JuMpS OvEr ThE lAzY dOg"
cyrillic <- "–ª–Æ–±–Ø, —Å–™–µ–®—å –©–∏–ü—Ü–´, ‚Äî –≤–ó–¥–û—Ö–ù—ë–¢ –º–≠—Ä, ‚Äî –∫–ê–π–§ –∂–ì—É–ß"
str_to_upper(latin)
str_to_lower(cyrillic)
str_to_title(latin)
```

### –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
–ü–æ–¥—Å—Ç—Ä–æ–∫—É –≤ —Å—Ç—Ä–æ–∫–µ –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏: –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º —Ñ—É–Ω–∫—Ü–∏–µ–π `str_sub()`, –∏ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ —Ñ—É–Ω–∫—Ü–∏–µ–π `str_png()`.

![](images/5.07_str_sub.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(mutate = str_sub(mn, start = 1, end = 2))
```

![](images/5.08_str_extract.png)      

```{r}
tibble(mn = month.name) %>% 
  mutate(mutate = str_extract(mn, "r"))
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏—è `str_extract()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —à–∞–±–ª–æ–Ω—É. –¢–∞–∫–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `str_extract_all()`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–¥—Å—Ç—Ä–æ–∫, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —à–∞–±–ª–æ–Ω—É, –æ–¥–Ω–∞–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Ç–∏–ø–∞ —Å–ø–∏—Å–æ–∫.

```{r}
str_extract_all(month.name, "r")
```

### –ó–∞–º–µ–Ω–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏

–°—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `str_replace()`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–º–µ–Ω–∏—Ç—å –æ–¥–Ω—É –ø–æ–¥—Å—Ç—Ä–æ–∫—É –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∞ –¥—Ä—É–≥—É—é:

![](images/5.11_str_replace.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(mutate = str_replace(mn, "r", "R"))
```

–ö–∞–∫ –∏ –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `str_replace()` –¥–µ–ª–∞–µ—Ç –ª–∏—à—å –æ–¥–Ω—É –∑–∞–º–µ–Ω—É, —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `str_replace_all()`:

![](images/5.12_str_replace_all.png)

```{r}
tibble(mn = month.name) %>% 
  mutate(mutate = str_replace_all(mn, "r", "R"))
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `str_remove()` –∏ `str_remove_all()`

```{r}
tibble(month.name) %>% 
  mutate(mutate = str_remove(month.name, "r"))
tibble(month.name) %>% 
  mutate(mutate = str_remove_all(month.name, "r"))
```

### –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫

–í –ø–∞–∫–µ—Ç–µ `stringi` —Å—É—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–Ω–æ–≥–æ –º–µ—Ç–æ–¥–æ–≤ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–π —Å—Ç—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥–æ–π `stri_trans_list()`. –í–æ—Ç –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–∑ –Ω–∏—Ö:

```{r}
stri_trans_general("stringi", "latin-cyrillic")
stri_trans_general("—Å—ã—Ä–Ω–∏–∫–∏", "cyrillic-latin")
stri_trans_general("stringi", "latin-greek")
stri_trans_general("stringi", "latin-armenian")
```

```{block, type = "rmdtask"}
–í–æ—Ç –¥–≤–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞:

* [—Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏](https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/cities_of_russia.csv)
* [—á–∞—Å—Ç–æ—Ç–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ [–®–∞—Ä–æ–≤, –õ—è—à–µ–≤—Å–∫–∞—è 2011]](https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/freq_dict_2011.csv)

–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–∫–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥–æ–≤ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–º —Å–ª–æ–≤–æ–º —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–æ—Ä–æ–¥ –û—Ä—ë–ª)? –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å —ë –Ω–∞ –µ.
```

```{r, cache=TRUE, include=FALSE}
read_csv("https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/cities_of_russia.csv") %>% 
  mutate(city = str_to_lower(city),
         city = str_replace_all(city, "—ë", "–µ"), 
         town = TRUE) ->
  cities

dict <- read_tsv("https://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/freq_dict_2011.csv") %>% 
  mutate(lemma = str_replace_all(lemma, "—ë", "–µ")) %>% 
  left_join(cities, by = c("lemma" = "city")) ->
  result
result %>% 
  count(town)
# 69
```


<details> <summary> üìã —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫ ‚û° </summary> 

<details> <summary> üëÅ –î–∞—Ç–∞—Å–µ—Ç—ã —Å–∫–∞—á–∞–ª–∏—Å—å, —á—Ç–æ –¥–∞–ª—å—à–µ? ‚û° </summary>
–ù–∞–¥–æ –∏—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∫ –Ω—É–∂–Ω–æ–º—É –≤–∏–¥—É –∏ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å. <br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ –∏—Ö —Å–æ–µ–¥–∏–Ω–∏—Ç—å? –ß—Ç–æ —É –Ω–∏—Ö –æ–±—â–µ–≥–æ? ‚û° </summary>  
–í –æ–¥–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –µ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `city`, –≤ –¥—Ä—É–≥–æ–º -- –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `lemma`. –í—Å–µ –≥–æ—Ä–æ–¥–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã, –≤—Å–µ –ª–µ–º–º—ã —Å –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã. –Ø –±—ã —É–º–µ–Ω—å—à–∏–ª –±—É–∫–≤—É –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ —Å –≥–æ—Ä–æ–¥–∞–º–∏, —Å–¥–µ–ª–∞–ª –±—ã –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ —Å –≥–æ—Ä–æ–¥–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `town`), —Å–æ–µ–¥–∏–Ω–∏–ª –±—ã –¥–∞—Ç–∞—Å–µ—Ç—ã –∏ –ø–æ—Å—á–∏—Ç–∞–ª –±—ã —Å–∫–æ–ª—å–∫–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–º –¥–∞—Ç–∞—Å–µ—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–π `town`.
<br>
</details>

<details> <summary> üëÅ –ê –∫–∞–∫ —Å–æ–µ–¥–Ω–∏—Ç—å? ‚û° </summary>
–Ø –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `dict %>% ... %>% left_join(cities)`. –ï—Å–ª–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö —Ä–∞–∑–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤, —Ç–æ —Å–ª–µ–¥—É–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã, –∫–∞–∫–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç:`dict %>% ... %>% left_join(cities, by = c("lemma" = "city"))`
<br>
</details>

<details> <summary> üëÅ –°–æ–µ–¥–∏–Ω–∏–ª–æ—Å—å –≤—Ä–æ–¥–µ... –ê –∫–∞–∫ –ø–æ—Å—á–∏—Ç–∞—Ç—å? ‚û° </summary>
–Ø –±—ã, –∫–∞–∫ –æ–±—ã—á–Ω–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏—é `count()`.
<br>
</details>

</details>

## –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

## –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞

–î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –ø–∞–∫–µ—Ç–∞ `cld2` (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–π) –∏ `cld3` (–Ω–µ–π—Ä–æ—Å–µ—Ç—å).

```{r}
udhr_24 <- read_csv("")
udhr_24
cldhttps://raw.githubusercontent.com/agricolamz/DS_for_DH/master/data/article_24_from_UDHR.csv2::detect_language(udhr_24$article_text)
cld2::detect_language(udhr_24$article_text, lang_code = FALSE)
cld3::detect_language(udhr_24$article_text)
cld2::detect_language("–¢—ã –∂–µ–Ω–∞—Ç? –ì–æ–≤–æ—Ä–∏—Ç–µ –ª–∏ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏?")
cld3::detect_language("–¢—ã –∂–µ–Ω–∞—Ç? –ì–æ–≤–æ—Ä–∏—Ç–µ –ª–∏ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏?")
cld2::detect_language("–í–∞—Ä–∫–∞–ª–æ—Å—å. –•–ª–∏–≤–∫–∏–µ —à–æ—Ä—å–∫–∏ –ø—ã—Ä—è–ª–∏—Å—å –ø–æ –Ω–∞–≤–µ, –∏ —Ö—Ä—é–∫–æ—Ç–∞–ª–∏ –∑–µ–ª—é–∫–∏, –∫–∞–∫ –º—é–º–∑–∏–∫–∏ –≤ –º–æ–≤–µ.")
cld3::detect_language("–í–∞—Ä–∫–∞–ª–æ—Å—å. –•–ª–∏–≤–∫–∏–µ —à–æ—Ä—å–∫–∏ –ø—ã—Ä—è–ª–∏—Å—å –ø–æ –Ω–∞–≤–µ, –∏ —Ö—Ä—é–∫–æ—Ç–∞–ª–∏ –∑–µ–ª—é–∫–∏, –∫–∞–∫ –º—é–º–∑–∏–∫–∏ –≤ –º–æ–≤–µ.")
cld2::detect_language("–í–∞—Ä—á–∏–ª–æ—Å—å‚Ä¶ –•–ª–∏–≤'—è–∑–∫—ñ —Ç—Ö—É—Ä–∫–∏ –≤–∏–∫—Ä—É–ª–∏, —Å–≤–µ—Ä–±—á–∏—Å—å –Ω–∞–≤–∫—Ä—É–∑—ñ, –∂–∞—Å—É–º–Ω–æ–≤—ñ–ª—ñ —Ö—É–¥–æ–∫–∏ –≥—Ä–∏–≤—ñ–ª–∏ –∑–µ—Ö—Ä—è–∫–∏ –≤ —á—É–∑—ñ.")
cld3::detect_language("–í–∞—Ä—á–∏–ª–æ—Å—å‚Ä¶ –•–ª–∏–≤'—è–∑–∫—ñ —Ç—Ö—É—Ä–∫–∏ –≤–∏–∫—Ä—É–ª–∏, —Å–≤–µ—Ä–±—á–∏—Å—å –Ω–∞–≤–∫—Ä—É–∑—ñ, –∂–∞—Å—É–º–Ω–æ–≤—ñ–ª—ñ —Ö—É–¥–æ–∫–∏ –≥—Ä–∏–≤—ñ–ª–∏ –∑–µ—Ö—Ä—è–∫–∏ –≤ —á—É–∑—ñ.")
cld2::detect_language_mixed("–ú–Ω–æ–≥–∏–µ –≤ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ OpenDataScience –∑–∞–Ω–∏–º–∞—é—Ç—Å—è state-of-the-art —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è: DL-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏, –±–∞–π–µ—Å–æ–≤—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –Ω–µ —Ç–æ–ª—å–∫–æ.")
cld3::detect_language_mixed("–ú–Ω–æ–≥–∏–µ –≤ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ OpenDataScience –∑–∞–Ω–∏–º–∞—é—Ç—Å—è state-of-the-art —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è: DL-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏, –±–∞–π–µ—Å–æ–≤—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –Ω–µ —Ç–æ–ª—å–∫–æ.")
```


## –†–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏
