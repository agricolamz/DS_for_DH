[
["tidytext.html", "9 Работа с текстами: gutenbergr, tidytext, udpipe 9.1 Пакет gutenbergr 9.2 Библиотека tidytext 9.3 Пакет udpipe", " 9 Работа с текстами: gutenbergr, tidytext, udpipe library(tidyverse) 9.1 Пакет gutenbergr Пакет gutenbergr является API для очень старого проекта Guttenberg. library(gutenbergr) Все самое важное в этом пакете хранится в датасете gutenberg_metadata str(gutenberg_metadata) ## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 51997 obs. of 8 variables: ## $ gutenberg_id : int 0 1 2 3 4 5 6 7 8 9 ... ## $ title : chr NA &quot;The Declaration of Independence of the United States of America&quot; &quot;The United States Bill of Rights\\r\\nThe Ten Original Amendments to the Constitution of the United States&quot; &quot;John F. Kennedy&#39;s Inaugural Address&quot; ... ## $ author : chr NA &quot;Jefferson, Thomas&quot; &quot;United States&quot; &quot;Kennedy, John F. (John Fitzgerald)&quot; ... ## $ gutenberg_author_id: int NA 1638 1 1666 3 1 4 NA 3 3 ... ## $ language : chr &quot;en&quot; &quot;en&quot; &quot;en&quot; &quot;en&quot; ... ## $ gutenberg_bookshelf: chr NA &quot;United States Law/American Revolutionary War/Politics&quot; &quot;American Revolutionary War/Politics/United States Law&quot; NA ... ## $ rights : chr &quot;Public domain in the USA.&quot; &quot;Public domain in the USA.&quot; &quot;Public domain in the USA.&quot; &quot;Public domain in the USA.&quot; ... ## $ has_text : logi TRUE TRUE TRUE TRUE TRUE TRUE ... ## - attr(*, &quot;date_updated&quot;)= Date, format: &quot;2016-05-05&quot; Например, сейчас мы можем понять, сколько книг на разных языках можно скачать из проекта: gutenberg_metadata %&gt;% count(language, sort = TRUE) ## # A tibble: 103 x 2 ## language n ## &lt;chr&gt; &lt;int&gt; ## 1 en 42719 ## 2 fr 2658 ## 3 de 1387 ## 4 fi 1341 ## 5 nl 723 ## 6 it 672 ## 7 pt 537 ## 8 es 470 ## 9 zh 408 ## 10 el 216 ## # … with 93 more rows Как видно, в основном это тексты на английском. Сколько авторов в датасете? gutenberg_metadata %&gt;% count(author, sort = TRUE) ## # A tibble: 16,190 x 2 ## author n ## &lt;chr&gt; &lt;int&gt; ## 1 &lt;NA&gt; 3457 ## 2 Various 3199 ## 3 Anonymous 724 ## 4 Shakespeare, William 317 ## 5 Lytton, Edward Bulwer Lytton, Baron 219 ## 6 Twain, Mark 214 ## 7 Ebers, Georg 171 ## 8 Dickens, Charles 163 ## 9 Verne, Jules 151 ## 10 Unknown 141 ## # … with 16,180 more rows Сколько произведений Джейн Остин (не перепутайте с другими Остин) есть в датасете? gutenberg_metadata %&gt;% filter(author == &quot;Austen, Jane&quot;) %&gt;% distinct(gutenberg_id, title) ## # A tibble: 29 x 2 ## gutenberg_id title ## &lt;int&gt; &lt;chr&gt; ## 1 105 Persuasion ## 2 121 Northanger Abbey ## 3 141 Mansfield Park ## 4 158 Emma ## 5 161 Sense and Sensibility ## 6 946 Lady Susan ## 7 1212 Love and Freindship [sic] ## 8 1342 Pride and Prejudice ## 9 19839 Emma ## 10 20682 Northanger Abbey ## # … with 19 more rows Давайте скачаем “Эмму”: emma &lt;- gutenberg_download(158) ## Determining mirror for Project Gutenberg from http://www.gutenberg.org/robot/harvest ## Using mirror http://aleph.gutenberg.org emma ## # A tibble: 16,235 x 2 ## gutenberg_id text ## &lt;int&gt; &lt;chr&gt; ## 1 158 EMMA ## 2 158 &quot;&quot; ## 3 158 By Jane Austen ## 4 158 &quot;&quot; ## 5 158 &quot;&quot; ## 6 158 &quot;&quot; ## 7 158 &quot;&quot; ## 8 158 VOLUME I ## 9 158 &quot;&quot; ## 10 158 &quot;&quot; ## # … with 16,225 more rows Можно скачивать сразу несколько книг. Давайте добавим еще “Леди Сьюзен”: books &lt;- gutenberg_download(c(158, 946), meta_fields = &quot;title&quot;) books ## # A tibble: 18,760 x 3 ## gutenberg_id text title ## &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 158 EMMA Emma ## 2 158 &quot;&quot; Emma ## 3 158 By Jane Austen Emma ## 4 158 &quot;&quot; Emma ## 5 158 &quot;&quot; Emma ## 6 158 &quot;&quot; Emma ## 7 158 &quot;&quot; Emma ## 8 158 VOLUME I Emma ## 9 158 &quot;&quot; Emma ## 10 158 &quot;&quot; Emma ## # … with 18,750 more rows books %&gt;% count(title) ## # A tibble: 2 x 2 ## title n ## &lt;chr&gt; &lt;int&gt; ## 1 Emma 16235 ## 2 Lady Susan 2525 Сколько уникальных заголовков из базы данных содержит “Sherlock Holmes”? 9.2 Библиотека tidytext Сейчас скачанные книги записаны в таблицу, где одна строка это один абзац. Хочется мочь посчитать слова. Для этого книги нужно привести в tidy формат и для этого написан пакет tidytext: library(tidytext) books %&gt;% unnest_tokens(word, text) ## # A tibble: 184,145 x 3 ## gutenberg_id title word ## &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 158 Emma emma ## 2 158 Emma by ## 3 158 Emma jane ## 4 158 Emma austen ## 5 158 Emma volume ## 6 158 Emma i ## 7 158 Emma chapter ## 8 158 Emma i ## 9 158 Emma emma ## 10 158 Emma woodhouse ## # … with 184,135 more rows Теперь можно посчитать самые частотные слова в обоих произведениях: books %&gt;% unnest_tokens(word, text) %&gt;% count(title, word, sort = TRUE) ## # A tibble: 10,285 x 3 ## title word n ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 Emma to 5239 ## 2 Emma the 5201 ## 3 Emma and 4896 ## 4 Emma of 4291 ## 5 Emma i 3177 ## 6 Emma a 3129 ## 7 Emma it 2528 ## 8 Emma her 2462 ## 9 Emma was 2398 ## 10 Emma she 2340 ## # … with 10,275 more rows Ну… Это было ожидаемо. Нужно убрать стопслова. Английские стопслова встроены в пакет (переменная stop_words): books %&gt;% unnest_tokens(word, text) %&gt;% count(title, word, sort = TRUE) %&gt;% anti_join(stop_words) ## Joining, by = &quot;word&quot; ## # A tibble: 9,324 x 3 ## title word n ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 Emma emma 786 ## 2 Emma miss 599 ## 3 Emma harriet 415 ## 4 Emma weston 389 ## 5 Emma knightley 356 ## 6 Emma elton 319 ## 7 Emma jane 282 ## 8 Emma time 279 ## 9 Emma woodhouse 277 ## 10 Emma dear 241 ## # … with 9,314 more rows Постройте следующий график, на котором представлены самые частотные 20 слов каждого из произведений. ## Joining, by = &quot;word&quot; Функция unnest_tokens() позволяет работать не только со словами, но и, напрмиер, с биграммами: books %&gt;% unnest_tokens(word, text, token = &quot;ngrams&quot;, n = 2) ## # A tibble: 184,143 x 3 ## gutenberg_id title word ## &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 158 Emma emma by ## 2 158 Emma by jane ## 3 158 Emma jane austen ## 4 158 Emma austen volume ## 5 158 Emma volume i ## 6 158 Emma i chapter ## 7 158 Emma chapter i ## 8 158 Emma i emma ## 9 158 Emma emma woodhouse ## 10 158 Emma woodhouse handsome ## # … with 184,133 more rows 9.3 Пакет udpipe library(udpipe) Модели качаются очень долго. enmodel &lt;- udpipe_download_model(language = &quot;english&quot;) ## Downloading udpipe model from https://raw.githubusercontent.com/jwijffels/udpipe.models.ud.2.4/master/inst/udpipe-ud-2.4-190531/english-ewt-ud-2.4-190531.udpipe to /home/agricolamz/work/materials/2019_ds4dh/class_materials/english-ewt-ud-2.4-190531.udpipe ## Visit https://github.com/jwijffels/udpipe.models.ud.2.4 for model license details Теперь можно распарсить какое-нибудь предложение: udpipe(&quot;The want of Miss Taylor would be felt every hour of every day.&quot;, object = enmodel) ## doc_id paragraph_id sentence_id ## 1 doc1 1 1 ## 2 doc1 1 1 ## 3 doc1 1 1 ## 4 doc1 1 1 ## 5 doc1 1 1 ## 6 doc1 1 1 ## 7 doc1 1 1 ## 8 doc1 1 1 ## 9 doc1 1 1 ## 10 doc1 1 1 ## 11 doc1 1 1 ## 12 doc1 1 1 ## 13 doc1 1 1 ## 14 doc1 1 1 ## sentence start end ## 1 The want of Miss Taylor would be felt every hour of every day. 1 3 ## 2 The want of Miss Taylor would be felt every hour of every day. 5 8 ## 3 The want of Miss Taylor would be felt every hour of every day. 10 11 ## 4 The want of Miss Taylor would be felt every hour of every day. 13 16 ## 5 The want of Miss Taylor would be felt every hour of every day. 18 23 ## 6 The want of Miss Taylor would be felt every hour of every day. 25 29 ## 7 The want of Miss Taylor would be felt every hour of every day. 31 32 ## 8 The want of Miss Taylor would be felt every hour of every day. 34 37 ## 9 The want of Miss Taylor would be felt every hour of every day. 39 43 ## 10 The want of Miss Taylor would be felt every hour of every day. 45 48 ## 11 The want of Miss Taylor would be felt every hour of every day. 50 51 ## 12 The want of Miss Taylor would be felt every hour of every day. 53 57 ## 13 The want of Miss Taylor would be felt every hour of every day. 59 61 ## 14 The want of Miss Taylor would be felt every hour of every day. 62 62 ## term_id token_id token lemma upos xpos ## 1 1 1 The the DET DT ## 2 2 2 want want NOUN NN ## 3 3 3 of of ADP IN ## 4 4 4 Miss miss PROPN NNP ## 5 5 5 Taylor Taylor PROPN NNP ## 6 6 6 would would AUX MD ## 7 7 7 be be AUX VB ## 8 8 8 felt feel VERB VBN ## 9 9 9 every every DET DT ## 10 10 10 hour hour NOUN NN ## 11 11 11 of of ADP IN ## 12 12 12 every every DET DT ## 13 13 13 day day NOUN NN ## 14 14 14 . . PUNCT . ## feats head_token_id dep_rel deps ## 1 Definite=Def|PronType=Art 2 det &lt;NA&gt; ## 2 Number=Sing 8 nsubj:pass &lt;NA&gt; ## 3 &lt;NA&gt; 4 case &lt;NA&gt; ## 4 Number=Sing 2 nmod &lt;NA&gt; ## 5 Number=Sing 4 flat &lt;NA&gt; ## 6 VerbForm=Fin 8 aux &lt;NA&gt; ## 7 VerbForm=Inf 8 aux:pass &lt;NA&gt; ## 8 Tense=Past|VerbForm=Part|Voice=Pass 0 root &lt;NA&gt; ## 9 &lt;NA&gt; 10 det &lt;NA&gt; ## 10 Number=Sing 8 obl:tmod &lt;NA&gt; ## 11 &lt;NA&gt; 13 case &lt;NA&gt; ## 12 &lt;NA&gt; 13 det &lt;NA&gt; ## 13 Number=Sing 10 nmod &lt;NA&gt; ## 14 &lt;NA&gt; 8 punct &lt;NA&gt; ## misc ## 1 &lt;NA&gt; ## 2 &lt;NA&gt; ## 3 &lt;NA&gt; ## 4 &lt;NA&gt; ## 5 &lt;NA&gt; ## 6 &lt;NA&gt; ## 7 &lt;NA&gt; ## 8 &lt;NA&gt; ## 9 &lt;NA&gt; ## 10 &lt;NA&gt; ## 11 &lt;NA&gt; ## 12 &lt;NA&gt; ## 13 SpaceAfter=No ## 14 SpacesAfter=\\\\n Скачаем русскую модель: rumodel &lt;- udpipe_download_model(language = &quot;russian-syntagrus&quot;) ## Downloading udpipe model from https://raw.githubusercontent.com/jwijffels/udpipe.models.ud.2.4/master/inst/udpipe-ud-2.4-190531/russian-syntagrus-ud-2.4-190531.udpipe to /home/agricolamz/work/materials/2019_ds4dh/class_materials/russian-syntagrus-ud-2.4-190531.udpipe ## Visit https://github.com/jwijffels/udpipe.models.ud.2.4 for model license details udpipe(&quot;Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина.&quot;, object = rumodel) ## doc_id paragraph_id sentence_id ## 1 doc1 1 1 ## 2 doc1 1 1 ## 3 doc1 1 1 ## 4 doc1 1 1 ## 5 doc1 1 1 ## 6 doc1 1 1 ## 7 doc1 1 1 ## 8 doc1 1 1 ## 9 doc1 1 1 ## 10 doc1 1 1 ## 11 doc1 1 1 ## 12 doc1 1 1 ## 13 doc1 1 1 ## 14 doc1 1 1 ## 15 doc1 1 1 ## 16 doc1 1 1 ## 17 doc1 1 1 ## 18 doc1 1 1 ## 19 doc1 1 1 ## 20 doc1 1 1 ## 21 doc1 1 1 ## sentence ## 1 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 2 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 3 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 4 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 5 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 6 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 7 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 8 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 9 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 10 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 11 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 12 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 13 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 14 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 15 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 16 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 17 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 18 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 19 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 20 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## 21 Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина. ## start end term_id token_id token lemma upos xpos ## 1 1 4 1 1 Жила жить VERB &lt;NA&gt; ## 2 5 5 2 2 - - PUNCT &lt;NA&gt; ## 3 6 9 3 3 была быть AUX &lt;NA&gt; ## 4 11 12 4 4 на на ADP &lt;NA&gt; ## 5 14 18 5 5 свете свет NOUN &lt;NA&gt; ## 6 20 24 6 6 крыса крыса NOUN &lt;NA&gt; ## 7 26 26 7 7 в в ADP &lt;NA&gt; ## 8 28 34 8 8 морском морской ADJ &lt;NA&gt; ## 9 36 40 9 9 порту порт NOUN &lt;NA&gt; ## 10 42 52 10 10 Вальпараисо Вальпараисо ADV &lt;NA&gt; ## 11 53 53 11 11 , , PUNCT &lt;NA&gt; ## 12 55 56 12 12 на на ADP &lt;NA&gt; ## 13 58 63 13 13 складе склад NOUN &lt;NA&gt; ## 14 65 68 14 14 мяса мясо NOUN &lt;NA&gt; ## 15 70 70 15 15 и и CCONJ &lt;NA&gt; ## 16 72 76 16 16 маиса маис NOUN &lt;NA&gt; ## 17 77 77 17 17 , , PUNCT &lt;NA&gt; ## 18 79 83 18 18 какао какао NOUN &lt;NA&gt; ## 19 85 85 19 19 и и CCONJ &lt;NA&gt; ## 20 87 90 20 20 вина вино NOUN &lt;NA&gt; ## 21 91 91 21 21 . . PUNCT &lt;NA&gt; ## feats ## 1 Aspect=Imp|Gender=Fem|Mood=Ind|Number=Sing|Tense=Past|VerbForm=Fin|Voice=Act ## 2 &lt;NA&gt; ## 3 Aspect=Imp|Gender=Fem|Mood=Ind|Number=Sing|Tense=Past|VerbForm=Fin|Voice=Act ## 4 &lt;NA&gt; ## 5 Animacy=Inan|Case=Loc|Gender=Masc|Number=Sing ## 6 Animacy=Inan|Case=Gen|Gender=Masc|Number=Sing ## 7 &lt;NA&gt; ## 8 Case=Loc|Degree=Pos|Gender=Masc|Number=Sing ## 9 Animacy=Inan|Case=Loc|Gender=Masc|Number=Sing ## 10 Degree=Pos ## 11 &lt;NA&gt; ## 12 &lt;NA&gt; ## 13 Animacy=Inan|Case=Loc|Gender=Masc|Number=Sing ## 14 Animacy=Inan|Case=Gen|Gender=Neut|Number=Sing ## 15 &lt;NA&gt; ## 16 Animacy=Inan|Case=Gen|Gender=Masc|Number=Sing ## 17 &lt;NA&gt; ## 18 Animacy=Inan|Case=Gen|Gender=Neut|Number=Sing ## 19 &lt;NA&gt; ## 20 Animacy=Inan|Case=Gen|Gender=Neut|Number=Sing ## 21 &lt;NA&gt; ## head_token_id dep_rel deps misc ## 1 5 nsubj &lt;NA&gt; SpaceAfter=No ## 2 1 punct &lt;NA&gt; SpaceAfter=No ## 3 5 cop &lt;NA&gt; &lt;NA&gt; ## 4 5 case &lt;NA&gt; &lt;NA&gt; ## 5 0 root &lt;NA&gt; &lt;NA&gt; ## 6 5 nmod &lt;NA&gt; &lt;NA&gt; ## 7 9 case &lt;NA&gt; &lt;NA&gt; ## 8 9 amod &lt;NA&gt; &lt;NA&gt; ## 9 6 nmod &lt;NA&gt; &lt;NA&gt; ## 10 6 advmod &lt;NA&gt; SpaceAfter=No ## 11 13 punct &lt;NA&gt; &lt;NA&gt; ## 12 13 case &lt;NA&gt; &lt;NA&gt; ## 13 10 conj &lt;NA&gt; &lt;NA&gt; ## 14 13 nmod &lt;NA&gt; &lt;NA&gt; ## 15 16 cc &lt;NA&gt; &lt;NA&gt; ## 16 14 conj &lt;NA&gt; SpaceAfter=No ## 17 18 punct &lt;NA&gt; &lt;NA&gt; ## 18 10 conj &lt;NA&gt; &lt;NA&gt; ## 19 20 cc &lt;NA&gt; &lt;NA&gt; ## 20 10 conj &lt;NA&gt; SpaceAfter=No ## 21 5 punct &lt;NA&gt; SpacesAfter=\\\\n "]
]
