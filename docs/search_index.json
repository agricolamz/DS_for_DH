[
["tidytext.html", "9 Работа с текстами: gutenbergr, tidytext, udpipe 9.1 Пакет gutenbergr 9.2 Библиотека tidytext 9.3 Пакет udpipe", " 9 Работа с текстами: gutenbergr, tidytext, udpipe library(tidyverse) 9.1 Пакет gutenbergr Пакет gutenbergr является API для очень старого проекта Guttenberg. library(gutenbergr) Все самое важное в этом пакете хранится в датасете gutenberg_metadata str(gutenberg_metadata) ## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 51997 obs. of 8 variables: ## $ gutenberg_id : int 0 1 2 3 4 5 6 7 8 9 ... ## $ title : chr NA &quot;The Declaration of Independence of the United States of America&quot; &quot;The United States Bill of Rights\\r\\nThe Ten Original Amendments to the Constitution of the United States&quot; &quot;John F. Kennedy&#39;s Inaugural Address&quot; ... ## $ author : chr NA &quot;Jefferson, Thomas&quot; &quot;United States&quot; &quot;Kennedy, John F. (John Fitzgerald)&quot; ... ## $ gutenberg_author_id: int NA 1638 1 1666 3 1 4 NA 3 3 ... ## $ language : chr &quot;en&quot; &quot;en&quot; &quot;en&quot; &quot;en&quot; ... ## $ gutenberg_bookshelf: chr NA &quot;United States Law/American Revolutionary War/Politics&quot; &quot;American Revolutionary War/Politics/United States Law&quot; NA ... ## $ rights : chr &quot;Public domain in the USA.&quot; &quot;Public domain in the USA.&quot; &quot;Public domain in the USA.&quot; &quot;Public domain in the USA.&quot; ... ## $ has_text : logi TRUE TRUE TRUE TRUE TRUE TRUE ... ## - attr(*, &quot;date_updated&quot;)= Date, format: &quot;2016-05-05&quot; Например, сейчас мы можем понять, сколько книг на разных языках можно скачать из проекта: gutenberg_metadata %&gt;% count(language, sort = TRUE) ## # A tibble: 103 x 2 ## language n ## &lt;chr&gt; &lt;int&gt; ## 1 en 42719 ## 2 fr 2658 ## 3 de 1387 ## 4 fi 1341 ## 5 nl 723 ## 6 it 672 ## 7 pt 537 ## 8 es 470 ## 9 zh 408 ## 10 el 216 ## # … with 93 more rows Как видно, в основном это тексты на английском. Сколько авторов в датасете? gutenberg_metadata %&gt;% count(author, sort = TRUE) ## # A tibble: 16,190 x 2 ## author n ## &lt;chr&gt; &lt;int&gt; ## 1 &lt;NA&gt; 3457 ## 2 Various 3199 ## 3 Anonymous 724 ## 4 Shakespeare, William 317 ## 5 Lytton, Edward Bulwer Lytton, Baron 219 ## 6 Twain, Mark 214 ## 7 Ebers, Georg 171 ## 8 Dickens, Charles 163 ## 9 Verne, Jules 151 ## 10 Unknown 141 ## # … with 16,180 more rows Сколько произведений Джейн Остин (не перепутайте с другими Остин) есть в датасете? gutenberg_metadata %&gt;% filter(author == &quot;Austen, Jane&quot;) %&gt;% distinct(gutenberg_id, title) ## # A tibble: 29 x 2 ## gutenberg_id title ## &lt;int&gt; &lt;chr&gt; ## 1 105 Persuasion ## 2 121 Northanger Abbey ## 3 141 Mansfield Park ## 4 158 Emma ## 5 161 Sense and Sensibility ## 6 946 Lady Susan ## 7 1212 Love and Freindship [sic] ## 8 1342 Pride and Prejudice ## 9 19839 Emma ## 10 20682 Northanger Abbey ## # … with 19 more rows Давайте скачаем “Эмму”: emma &lt;- gutenberg_download(158) ## Determining mirror for Project Gutenberg from http://www.gutenberg.org/robot/harvest ## Using mirror http://aleph.gutenberg.org emma ## # A tibble: 16,235 x 2 ## gutenberg_id text ## &lt;int&gt; &lt;chr&gt; ## 1 158 EMMA ## 2 158 &quot;&quot; ## 3 158 By Jane Austen ## 4 158 &quot;&quot; ## 5 158 &quot;&quot; ## 6 158 &quot;&quot; ## 7 158 &quot;&quot; ## 8 158 VOLUME I ## 9 158 &quot;&quot; ## 10 158 &quot;&quot; ## # … with 16,225 more rows Можно скачивать сразу несколько книг. Давайте добавим еще “Леди Сьюзен”: books &lt;- gutenberg_download(c(158, 946), meta_fields = &quot;title&quot;) books ## # A tibble: 18,760 x 3 ## gutenberg_id text title ## &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 158 EMMA Emma ## 2 158 &quot;&quot; Emma ## 3 158 By Jane Austen Emma ## 4 158 &quot;&quot; Emma ## 5 158 &quot;&quot; Emma ## 6 158 &quot;&quot; Emma ## 7 158 &quot;&quot; Emma ## 8 158 VOLUME I Emma ## 9 158 &quot;&quot; Emma ## 10 158 &quot;&quot; Emma ## # … with 18,750 more rows books %&gt;% count(title) ## # A tibble: 2 x 2 ## title n ## &lt;chr&gt; &lt;int&gt; ## 1 Emma 16235 ## 2 Lady Susan 2525 Сколько уникальных заголовков из базы данных содержит “Sherlock Holmes”? 9.2 Библиотека tidytext Сейчас скачанные книги записаны в таблицу, где одна строка это один абзац. Хочется мочь посчитать слова. Для этого книги нужно привести в tidy формат и для этого написан пакет tidytext: library(tidytext) books %&gt;% unnest_tokens(word, text) ## # A tibble: 184,145 x 3 ## gutenberg_id title word ## &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 158 Emma emma ## 2 158 Emma by ## 3 158 Emma jane ## 4 158 Emma austen ## 5 158 Emma volume ## 6 158 Emma i ## 7 158 Emma chapter ## 8 158 Emma i ## 9 158 Emma emma ## 10 158 Emma woodhouse ## # … with 184,135 more rows Теперь можно посчитать самые частотные слова в обоих произведениях: books %&gt;% unnest_tokens(word, text) %&gt;% count(title, word, sort = TRUE) ## # A tibble: 10,285 x 3 ## title word n ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 Emma to 5239 ## 2 Emma the 5201 ## 3 Emma and 4896 ## 4 Emma of 4291 ## 5 Emma i 3177 ## 6 Emma a 3129 ## 7 Emma it 2528 ## 8 Emma her 2462 ## 9 Emma was 2398 ## 10 Emma she 2340 ## # … with 10,275 more rows Ну… Это было ожидаемо. Нужно убрать стопслова. Английские стопслова встроены в пакет (переменная stop_words): books %&gt;% unnest_tokens(word, text) %&gt;% count(title, word, sort = TRUE) %&gt;% anti_join(stop_words) ## Joining, by = &quot;word&quot; ## # A tibble: 9,324 x 3 ## title word n ## &lt;chr&gt; &lt;chr&gt; &lt;int&gt; ## 1 Emma emma 786 ## 2 Emma miss 599 ## 3 Emma harriet 415 ## 4 Emma weston 389 ## 5 Emma knightley 356 ## 6 Emma elton 319 ## 7 Emma jane 282 ## 8 Emma time 279 ## 9 Emma woodhouse 277 ## 10 Emma dear 241 ## # … with 9,314 more rows Постройте следующий график, на котором представлены самые частотные 20 слов каждого из произведений. books %&gt;% unnest_tokens(word, text) %&gt;% count(title, word, sort = TRUE) %&gt;% anti_join(stop_words) %&gt;% group_by(title) %&gt;% slice(1:20) %&gt;% ggplot(aes(word, n))+ geom_col()+ coord_flip()+ facet_wrap(~title, scale = &quot;free&quot;) ## Joining, by = &quot;word&quot; Функция unnest_tokens() позволяет работать не только со словами, но и, напрмиер, с биграммами: books %&gt;% unnest_tokens(word, text, token = &quot;ngrams&quot;, n = 2) ## # A tibble: 184,143 x 3 ## gutenberg_id title word ## &lt;int&gt; &lt;chr&gt; &lt;chr&gt; ## 1 158 Emma emma by ## 2 158 Emma by jane ## 3 158 Emma jane austen ## 4 158 Emma austen volume ## 5 158 Emma volume i ## 6 158 Emma i chapter ## 7 158 Emma chapter i ## 8 158 Emma i emma ## 9 158 Emma emma woodhouse ## 10 158 Emma woodhouse handsome ## # … with 184,133 more rows 9.3 Пакет udpipe Модели качаются очень долго. library(udpipe) enmodel &lt;- udpipe_download_model(language = &quot;english&quot;) Теперь можно распарсить какое-нибудь предложение: udpipe(&quot;The want of Miss Taylor would be felt every hour of every day.&quot;, object = enmodel) Скачаем русскую модель: rumodel &lt;- udpipe_download_model(language = &quot;russian-syntagrus&quot;) udpipe(&quot;Жила-была на свете крыса в морском порту Вальпараисо, на складе мяса и маиса, какао и вина.&quot;, object = rumodel) "]
]
